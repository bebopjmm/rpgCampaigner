<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:context="http://www.springframework.org/schema/context"
       xmlns:mongo="http://www.springframework.org/schema/data/mongo"
       xmlns:mvc="http://www.springframework.org/schema/mvc"
       xsi:schemaLocation="http://www.springframework.org/schema/beans
        http://www.springframework.org/schema/beans/spring-beans-3.0.xsd
        http://www.springframework.org/schema/mvc
        http://www.springframework.org/schema/mvc/spring-mvc-3.0.xsd
        http://www.springframework.org/schema/data/mongo
        http://www.springframework.org/schema/data/mongo/spring-mongo-1.0.xsd
        http://www.springframework.org/schema/context
        http://www.springframework.org/schema/context/spring-context-3.0.xsd">

    <context:annotation-config />

    <context:component-scan base-package="org.lostkingdomsfrontier.rpgcampaigner">
        <context:exclude-filter type="annotation"
                                expression="org.springframework.context.annotation.Configuration" />
    </context:component-scan>

    <!-- Configures the @Controller programming model -->
    <mvc:annotation-driven />

    <bean id="campaignService" class="org.lostkingdomsfrontier.rpgcampaigner.core.services.CampaignEventHandler">
        <constructor-arg name="campaignRepository" ref="campaignRepository" />
        <constructor-arg name="playerRepository" ref="playerRepository" />
    </bean>

    <bean id="playerService" class="org.lostkingdomsfrontier.rpgcampaigner.core.services.PlayerEventHandler">
        <constructor-arg name="playerRepository" ref="playerRepository" />
    </bean>

    <bean id="mongoTemplate" class="org.springframework.data.mongodb.core.MongoTemplate">
        <constructor-arg name="mongo" ref="mongo" />
        <constructor-arg name="databaseName" value="rpg_campaigner_test" />
    </bean>

    <!-- Factory bean that creates the Mongo instance -->
    <mongo:mongo host="localhost" port="27017" />

    <!-- Activates repository support by scanning the configured package for
        interfaces extending MongoRepository. Will try to derive queries from the
        methods declared. The repository support will use the bean called 'mongoTemplate'
        by default. Use 'mongo-template-ref' attribute to customize. -->
    <mongo:repositories base-package="org.lostkingdomsfrontier.rpgcampaigner.core.dao" />

    <!-- Use this post processor to translate any MongoExceptions thrown in
        @Repository annotated classes -->
    <bean class="org.springframework.dao.annotation.PersistenceExceptionTranslationPostProcessor" />

</beans>